#! /usr/bin/bash

GZDOOMR_CONFIG="${HOME}/.config/gzdoom"
GZDOOMR_BIN=/usr/bin/gzdoomrun
GZDOOMR_GUI_1312_BIN=/usr/bin/gzdoomrungui-1-3-12
GZDOOMR_GUI_BIN=/usr/bin/gzdoomrungui
GZDOOMR_CUSTOM_DIR="${GZDOOMR_CONFIG}/custom"
GZDOOMR_CUSTOM="${GZDOOMR_CUSTOM_DIR}.py"
GZDOOMR_DESKTOP=/usr/share/applications/gzdoomrun.desktop
GZDOOMR_STEAM_BANNER="${GZDOOMR_CONFIG}/banner.jpg"
GZDOOMR_STEAM_LOGO="${GZDOOMR_CONFIG}/logo.png"
GZDOOMR_STEAM_ARTWORK="${GZDOOMR_CONFIG}/artwork.png"

function install-gzdoom () {
    printf "Installing GZDoom Run ... \n\n"

    sudo touch $GZDOOMR_BIN
    sudo cp ./gzdoomrun-main.py $GZDOOMR_BIN
    sudo cp ./gzdoomrun.py $GZDOOMR_BIN.py
    
    raco pkg install gui-easy
    raco exe ./gzdoomrungui.rkt
    sudo cp ./gzdoomrungui $GZDOOMR_GUI_1312_BIN
    rm ./gzdoomrungui
    sudo cp ./gzdoomrungui.py $GZDOOMR_GUI_BIN
    
    cp ./artwork.png $GZDOOMR_STEAM_ARTWORK
    cp ./logo.png $GZDOOMR_STEAM_LOGO
    cp ./banner.jpg $GZDOOMR_STEAM_BANNER
    cp ./custom.py $GZDOOMR_CUSTOM
    cp -r ./custom $GZDOOMR_CUSTOM_DIR
    
    sudo cp ./gzdoom-run.desktop $GZDOOMR_DESKTOP

    RET=$?
    printf "\nDone.\n"
    return $RET
}

function install-module () {
    PKG_NAME=$1
    unzip "./${PKG_NAME}.pkz"
    
    if [ $? -eq 0 ]
    then 
        cd $PKG_NAME
        ./install

        if [ $? -eq 0 ]
        then
            printf "\nDone.\n"
        else
            printf "\nCould not install %s!\n" $PKG_NAME
            return 1
        fi

        cd ..
    else
        cd $PKG_NAME

        if [ $? -eq 1 ]
        then
            printf "\nCould not install %s!\n" $PKG_NAME
            return 1
        else
            ./install

            if [ $? -eq 0 ]
            then 
                printf "\nDone.\n"
            else
                printf "\nCould not install %s!\n" $PKG_NAME
                return 1
            fi

            cd ..
        fi
    fi
    
    return 0
}

alias install-brutal="install-module brutal"
alias install-sigil="install-module sigil"

if [ $# -eq 1 ]
then
    ARG=$1
    
    if [ $ARG = gzdoom ]
    then
        install-gzdoom
    elif [ $ARG = brutal ]
    then
        install-brutal-doom
    elif [ $ARG = sigil ]
    then 
        install-sigil
    elif [ $ARG = all ]
    then 
        install-gzdoom
        install-brutal-doom 
        install-sigil
    else
        install-module $ARG
        if [ $? -eq 1 ]
            printf "\nInvalid argument '%s'\n" $ARG 
            exit 1
        fi
    fi
else 
    install-gzdoom
fi

exit $?

